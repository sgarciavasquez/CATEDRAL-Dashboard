<app-header></app-header>

<main class="container-7xl py-8">
    <div class="grid lg:grid-cols-4 gap-6">
        <!-- SIDEBAR -->
        <aside class="col-span-1">
            <nav class="bg-white rounded-xl p-4 shadow">
                <ul class="space-y-2 text-sm">
                    <li><a class="block px-3 py-2 rounded hover:bg-stone-50" routerLink="/profile">Datos personales</a>
                    </li>
                    <li><a class="block px-3 py-2 rounded hover:bg-stone-50"
                            routerLink="/profile/reservations">Historial de pedidos</a></li>
                    <li><a class="block px-3 py-2 rounded text-red-600 hover:bg-stone-50"
                            (click)="deleteAccount()">Eliminar cuenta</a></li>
                </ul>
            </nav>
        </aside>

        <!-- CONTENT -->
        <section class="col-span-3 space-y-6">
            <!-- DATOS PERSONALES -->
            <div class="bg-white rounded-xl p-6 shadow">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold">Datos personales</h2>
                    <div class="text-sm text-neutral-500">Editar tus datos</div>
                </div>

                <form class="mt-4 grid gap-3 sm:grid-cols-2" (ngSubmit)="save()" [formGroup]="form">
                    <div class="col-span-2 sm:col-span-1">
                        <label class="block text-xs text-neutral-600">Nombre</label>
                        <input class="w-full rounded border px-3 py-2" formControlName="name" />
                    </div>

                    <div class="col-span-2 sm:col-span-1">
                        <label class="block text-xs text-neutral-600">Correo</label>
                        <input class="w-full rounded border px-3 py-2 bg-stone-50" formControlName="email" />

                    </div>

                    <div class="col-span-2 sm:col-span-1">
                        <label class="block text-xs text-neutral-600">Celular</label>
                        <input class="w-full rounded border px-3 py-2" formControlName="phone" />
                    </div>

                    <div class="col-span-2 flex gap-3 items-center mt-2">
                        <button class="rounded-full bg-stone-900 text-white px-4 py-2" type="submit"
                            [disabled]="saving">
                            {{ saving ? 'Guardando...' : 'Guardar cambios' }}
                        </button>
                        <p *ngIf="okMsg" class="text-sm text-green-600">{{ okMsg }}</p>
                        <p *ngIf="error" class="text-sm text-red-600">{{ error }}</p>
                    </div>
                </form>
            </div>

            <!-- RESERVAS -->
            <div class="bg-white rounded-xl p-6 shadow">
                <h3 class="text-lg font-semibold mb-4">Mis reservas</h3>

                <div *ngIf="reservations?.length === 0" class="text-sm text-neutral-600">No tienes reservas.</div>

                <div class="space-y-4">
                    <article *ngFor="let r of reservations" class="border rounded-lg p-4">
                        <div class="flex items-start gap-4">
                            <ng-container *ngIf="r.items?.length; else noImg">
                                <img [src]="r.items[0].imageUrl" alt="">
                            </ng-container>
                            <ng-template #noImg>
                                <img src="assets/p1.png" alt="">
                            </ng-template>

                            <div class="flex-1">
                                <div class="text-sm text-neutral-500">Pedido Nº{{ r._id }}</div>
                                <div class="text-sm mt-1">
                                    <div *ngFor="let it of r.items" class="flex justify-between items-center">
                                        <div class="text-sm">{{ it.name }} <span class="text-xs text-neutral-500">· {{
                                                it.qty }} un.</span></div>
                                        <div class="text-sm font-medium">${{ it.price | number }}</div>
                                    </div>
                                </div>
                                <div class="mt-3 flex items-center justify-between">
                                    <div class="text-xs text-neutral-500">Fecha de reserva: {{ formatDate(r.createdAt)
                                        }}</div>
                                    <div class="text-sm font-semibold">Total <span class="ml-2">${{ r.total | number
                                            }}</span></div>
                                </div>
                            </div>
                        </div>
                    </article>
                </div>
            </div>

            <!-- ELIMINAR CUENTA -->
            <div class="bg-white rounded-xl p-6 shadow">
                <h4 class="text-lg font-semibold">Eliminar cuenta</h4>
                <p class="text-sm text-neutral-600 mt-2">¿Quieres eliminar todos tus datos de nuestro sistema? Esta
                    acción es irreversible.</p>
                <div class="mt-4">
                    <button class="bg-red-600 text-white px-4 py-2 rounded-full"
                        (click)="deleteAccount()">Eliminar</button>
                </div>
            </div>
        </section>
    </div>
</main>

<app-footer class="mt-auto"></app-footer>