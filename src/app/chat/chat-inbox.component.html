<app-header></app-header>
<div class="min-h-screen flex flex-col">

  <section class="max-w-5xl mx-auto p-4">
    <div class="mb-3 flex items-center justify-between">
      <div>
        <h1 class="text-lg font-semibold text-slate-900">
          Mensajes <span *ngIf="isAdmin" class="opacity-70">(Admin)</span>
        </h1>
        <p class="text-sm text-slate-600">
          {{ isAdmin ? 'Bandeja de clientes' : 'Conversaciones con la tienda' }}
        </p>
      </div>
      <button (click)="refresh()" class="rounded-full border px-3 py-1.5 text-sm hover:bg-slate-50">
        Recargar
      </button>
    </div>

    <div *ngIf="loading" class="text-sm text-slate-600">Cargandoâ€¦</div>
    <div *ngIf="!loading && error" class="text-sm text-rose-600">{{ error }}</div>

    <div *ngIf="!loading && !error" class="bg-white rounded-xl shadow-sm ring-1 ring-black/5 divide-y">
      <ng-container *ngIf="svc.chats$().length; else emptyState">
        <a *ngFor="let c of svc.chats$()" [routerLink]="[base, c.id]"
          class="flex items-center gap-3 px-4 py-3 hover:bg-slate-50">
          <div class="h-10 w-10 rounded-full bg-slate-200 grid place-items-center">ğŸ‘¤</div>

          <div class="min-w-0 flex-1">
            <div class="flex items-center justify-between">
              <p class="font-medium text-slate-900 truncate">{{ c.otherName }}</p>
              <span class="text-xs text-slate-500">{{ c.last.at | date:'short' }}</span>
            </div>
            <p class="text-sm text-slate-600 truncate">{{ c.last.text || 'Sin mensajes aÃºn' }}</p>
          </div>

          <span *ngIf="c.unread>0"
            class="ml-2 min-w-6 h-6 grid place-items-center rounded-full bg-rose-600 text-white text-xs px-1">
            {{ c.unread }}
          </span>

          <button type="button" class="ml-2 p-1 rounded hover:bg-red-50 text-slate-400 hover:text-red-500"
            (click)="deleteChat(c, $event)">
            ğŸ—‘ï¸
          </button>
        </a>
      </ng-container>
    </div>

    <ng-template #emptyState>
      <div class="p-6 text-center text-sm text-slate-600">
        No tienes conversaciones todavÃ­a.
      </div>
    </ng-template>

  </section>

  <app-footer class="mt-auto"></app-footer>
</div>