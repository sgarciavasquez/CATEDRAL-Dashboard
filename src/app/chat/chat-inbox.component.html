<app-header></app-header>

<div class="min-h-screen flex flex-col bg-[#f7f9fc]">
  <section
    class="w-full max-w-5xl mx-auto flex-1 px-3 py-4 sm:px-4 sm:py-6"
  >
    <!-- Encabezado + acciÃ³n -->
    <div
      class="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2"
    >
      <div>
        <h1 class="text-lg sm:text-xl font-semibold text-slate-900">
          Mensajes
          <span *ngIf="isAdmin" class="opacity-70 text-sm">(Admin)</span>
        </h1>
        <p class="text-xs sm:text-sm text-slate-600">
          {{
            isAdmin
              ? 'Bandeja de conversaciones con clientes.'
              : 'Conversaciones con la tienda.'
          }}
        </p>
      </div>

      <button
        (click)="refresh()"
        class="self-start sm:self-auto rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs sm:text-sm hover:bg-slate-50"
      >
        Recargar
      </button>
    </div>

    <!-- Estados -->
    <div *ngIf="loading" class="text-sm text-slate-600">
      Cargandoâ€¦
    </div>
    <div *ngIf="!loading && error" class="text-sm text-rose-600">
      {{ error }}
    </div>

    <!-- Lista -->
    <div
      *ngIf="!loading && !error"
      class="bg-white rounded-xl shadow-sm ring-1 ring-black/5 divide-y"
    >
      <ng-container *ngIf="svc.chats$().length; else emptyState">
        <a
          *ngFor="let c of svc.chats$()"
          [routerLink]="[base, c.id]"
          class="flex items-center gap-3 px-3 sm:px-4 py-3 hover:bg-slate-50"
        >
          <!-- Avatar -->
          <div
            class="h-9 w-9 sm:h-10 sm:w-10 rounded-full bg-slate-200 grid place-items-center text-sm"
          >
            ğŸ‘¤
          </div>

          <!-- Texto -->
          <div class="min-w-0 flex-1">
            <div class="flex items-center justify-between gap-2">
              <p
                class="font-medium text-slate-900 truncate text-sm sm:text-base"
              >
                {{ c.otherName }}
              </p>
              <span class="text-[11px] sm:text-xs text-slate-500 shrink-0">
                {{ c.last.at | date: 'shortTime' }}
              </span>
            </div>
            <p
              class="mt-0.5 text-xs sm:text-sm text-slate-600 truncate max-w-full"
            >
              {{ c.last.text || 'Sin mensajes aÃºn' }}
            </p>
          </div>

          <!-- Badge de no leÃ­dos -->
          <span
            *ngIf="c.unread > 0"
            class="ml-1 min-w-6 h-6 grid place-items-center rounded-full bg-rose-600 text-white text-[11px] px-1"
          >
            {{ c.unread }}
          </span>

          <!-- Eliminar (solo Ã­cono, mejor en mÃ³vil) -->
          <button
            type="button"
            class="ml-1 p-1 rounded-full hover:bg-red-50 text-slate-400 hover:text-red-500 shrink-0"
            (click)="deleteChat(c, $event)"
            aria-label="Eliminar chat"
          >
            ğŸ—‘ï¸
          </button>
        </a>
      </ng-container>
    </div>

    <ng-template #emptyState>
      <div
        class="mt-3 rounded-xl bg-white p-4 text-center text-sm text-slate-600 ring-1 ring-black/5"
      >
        No tienes conversaciones todavÃ­a.
      </div>
    </ng-template>
  </section>

  <app-footer class="mt-auto"></app-footer>
</div>
