<article class="group relative pcard h-full flex flex-col rounded-2xl bg-white shadow-sm ring-1 ring-black/5 p-3
         transition hover:shadow-md hover:-translate-y-0.5">

  <!-- bloque superior -->
  <div class="flex gap-3 items-start">
    <!-- thumb -->
    <div class="shrink-0 w-14 h-14 sm:w-16 sm:h-16 rounded-lg bg-gradient-to-br from-slate-100 to-slate-50
             ring-1 ring-black/5 grid place-items-center overflow-hidden">
      <img [src]="product.imageUrl || 'assets/placeholder.png'" [alt]="product.name"
        (error)="$event.target['src'] = 'assets/placeholder.png'" class="h-12 w-12 sm:h-14 sm:w-14 object-contain"
        loading="lazy" decoding="async" />
    </div>

    <!-- info -->
    <div class="min-w-0 flex-1">
      <span class="text-[10px] tracking-wide text-slate-500">{{ product.code }}</span>

      <!-- nombre -->
      <h3 class="mt-0.5 text-[14px] font-semibold text-slate-900 leading-snug
               [display:-webkit-box] [-webkit-line-clamp:2] [-webkit-box-orient:vertical] overflow-hidden">
        {{ product.name }}
      </h3>

      <!-- stock debajo del nombre -->
      <div class="mt-0.5 text-[11px] text-slate-600">
        Stock:
        <span [ngClass]="product.inStock > 0 ? 'text-emerald-600 font-semibold' : 'text-rose-600 font-semibold'">
          {{ product.inStock > 0 ? product.inStock : '0' }}
        </span>
      </div>

      <!-- precio -->
      <div class="mt-1">
        <div class="text-[11px] text-slate-500">Precio</div>
        <div class="text-[18px] font-bold tracking-tight text-slate-900">
          {{ product.price | currency:'CLP':'symbol':'1.0-0' }}
        </div>
      </div>

      <!-- estrellas debajo del precio -->
      <div class="mt-1 flex items-center gap-0.5">
        <app-star-rating [value]="product.rating || 0" [readOnly]="true" [showNumber]="false">
        </app-star-rating>
      </div>

    </div>
  </div>

  <!-- separador flexible -->
  <div class="mt-2 flex-1"></div>

  <!-- chips -->
  <div *ngIf="product.categoryNames.length" class="mt-2 mb-2 flex flex-wrap gap-1">
    <span *ngFor="let c of product.categoryNames" class="inline-flex items-center rounded-full bg-slate-100 text-slate-700
                 text-[10.5px] px-1.5 py-0.5 ring-1 ring-black/5">
      {{ c }}
    </span>
  </div>

  <!-- FOOTER de acciones (compacto) -->
  <div class="mt-auto">
    <div class="flex gap-2">
      <button type="button" (click)="onAddToCart($event)" [disabled]="product.inStock <= 0" class="inline-flex items-center justify-center gap-1.5 rounded-lg bg-slate-900 text-white
         px-3 py-1.5 text-[13px] font-medium shadow w-full
         transition
         hover:brightness-110 active:scale-[.98]
         disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:brightness-100 disabled:active:scale-100">

        <svg *ngIf="product.inStock > 0" width="16" height="16" viewBox="0 0 24 24" fill="none" class="-ml-0.5">
          <path d="M3 6h2l2 10h10l2-7H7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
          <circle cx="10" cy="20" r="1.4" fill="currentColor" />
          <circle cx="17" cy="20" r="1.4" fill="currentColor" />
        </svg>

        {{ product.inStock > 0 ? 'Agregar' : 'Sin stock' }}
      </button>


      <a [routerLink]="['/producto', product.id]" class="inline-flex items-center justify-center gap-1.5 rounded-lg border border-slate-300
               px-3 py-1.5 text-[13px] font-medium text-slate-700 hover:bg-slate-50 active:scale-[.98]
               transition w-full">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.6" />
          <path d="M12 8v6m0 3h.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" />
        </svg>
        Detalles
      </a>
    </div>
  </div>
</article>