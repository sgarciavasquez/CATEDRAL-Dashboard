<header class="w-full bg-[#2f3f56] text-white shadow">
  <div class="container-7xl px-3 py-2">
    <!-- ====== DESKTOP (md+) ====== -->
    <div class="hidden md:grid md:grid-cols-[1fr_auto_1fr] md:items-center md:gap-4">
      <!-- Logo -->
      <a routerLink="/" class="flex items-center gap-2 justify-self-start">
        <img src="assets/logo_bl.png" alt="Catedral Perfumes" class="h-9 w-auto" />
      </a>

      <!-- Marca CENTRADA -->
      <a routerLink="/" class="justify-self-center text-center leading-tight select-none">
        <div class="uppercase font-bold text-[22px] sm:text-[24px] md:text-[28px] tracking-[0.28em] md:tracking-[0.32em]">
          CATEDRAL
        </div>
        <div class="uppercase text-[9px] sm:text-[10px] md:text-[11px] tracking-[0.36em] md:tracking-[0.42em] opacity-90">
          PERFUMES
        </div>
      </a>

      <!-- Buscador + iconos (derecha) -->
      <div class="flex items-center gap-3 justify-self-end">
        <!-- Iconos -->
        <ng-container *ngIf="(user$ | async) as _; else guestDesktop">
          <a
            [routerLink]="['/perfil']"
            title="Perfil"
            aria-label="Perfil"
            class="grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
          >
            <mat-icon>person</mat-icon>
          </a>

          <a
            *ngIf="isAdmin$ | async"
            routerLink="/admin/pedidos"
            title="Administrar pedidos"
            aria-label="Administrar pedidos"
            class="grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
          >
            <mat-icon>inventory_2</mat-icon>
          </a>

          <button
            title="Salir"
            aria-label="Salir"
            class="grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
            (click)="logout()"
          >
            <mat-icon>logout</mat-icon>
          </button>
        </ng-container>

        <ng-template #guestDesktop>
          <a routerLink="/auth/login" title="Ingresar" aria-label="Ingresar" class="underline">Ingresar</a>
          <a routerLink="/auth/register" title="Registrarse" aria-label="Registrarse" class="underline">Registrarse</a>
        </ng-template>

        <!-- Mensajes: SOLO si hay usuario logeado -->
        <ng-container *ngIf="(user$ | async) as _">
          <ng-container *ngIf="isAdmin$ | async; else userChatDesktop">
            <!-- Admin -->
            <a
              routerLink="/admin/chat"
              title="Mensajes"
              aria-label="Mensajes"
              class="relative grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
            >
              <mat-icon>chat_bubble</mat-icon>
              <span
                *ngIf="unreadMessages() > 0"
                class="absolute -top-1.5 -right-1.5 text-[10px] rounded-full bg-rose-500 text-white px-1.5 py-[1px] leading-none"
              >
                {{ unreadMessages() }}
              </span>
            </a>
          </ng-container>

          <ng-template #userChatDesktop>
            <!-- Cliente -->
            <a
              routerLink="/chat"
              title="Mensajes"
              aria-label="Mensajes"
              class="relative grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
            >
              <mat-icon>chat_bubble</mat-icon>
              <span
                *ngIf="unreadMessages() > 0"
                class="absolute -top-1.5 -right-1.5 text-[10px] rounded-full bg-rose-500 text-white px-1.5 py-[1px] leading-none"
              >
                {{ unreadMessages() }}
              </span>
            </a>
          </ng-template>
        </ng-container>

        <!-- Carro -->
        <a
          routerLink="/cart"
          title="Carro"
          aria-label="Carro"
          class="relative grid place-items-center w-9 h-9 rounded-full bg-white/10 hover:bg-white/20 transition"
        >
          <mat-icon>shopping_cart</mat-icon>
          <span
            *ngIf="(count$ | async) as count"
            class="absolute -top-1.5 -right-1.5 text-[10px] rounded-full bg-amber-400 text-black px-1.5 py-[1px] leading-none"
          >
            {{ count }}
          </span>
        </a>
      </div>
    </div>

    <!-- ====== MOBILE (md-) ====== -->
    <div class="flex flex-col gap-2 md:hidden">
      <!-- fila 1: logo + iconos -->
      <div class="flex items-center justify-between gap-3">
        <a routerLink="/" class="flex items-center gap-2">
          <img src="assets/logo_bl.png" alt="Catedral Perfumes" class="h-8 w-auto" />
        </a>

        <div class="flex items-center gap-2">
          <!-- Iconos mÃ³vil -->
          <ng-container *ngIf="(user$ | async) as _; else guestMobile">
            <a
              [routerLink]="['/perfil']"
              title="Perfil"
              aria-label="Perfil"
              class="grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
            >
              <mat-icon class="!text-[20px]">person</mat-icon>
            </a>

            <a
              *ngIf="isAdmin$ | async"
              routerLink="/admin/pedidos"
              title="Admin"
              aria-label="Admin"
              class="grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
            >
              <mat-icon class="!text-[20px]">inventory_2</mat-icon>
            </a>

            <button
              title="Salir"
              aria-label="Salir"
              class="grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
              (click)="logout()"
            >
              <mat-icon class="!text-[20px]">logout</mat-icon>
            </button>
          </ng-container>

          <ng-template #guestMobile>
            <a routerLink="/auth/login" title="Ingresar" aria-label="Ingresar" class="text-xs underline">Ingresar</a>
          </ng-template>

          <!-- Mensajes: SOLO si hay usuario logeado -->
          <ng-container *ngIf="(user$ | async) as _">
            <ng-container *ngIf="isAdmin$ | async; else userChatMobile">
              <a
                routerLink="/admin/chat"
                title="Mensajes"
                aria-label="Mensajes"
                class="relative grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
              >
                <mat-icon class="!text-[20px]">chat_bubble</mat-icon>
                <span
                  *ngIf="unreadMessages() > 0"
                  class="absolute -top-1.5 -right-1.5 text-[9px] rounded-full bg-rose-500 text-white px-1.5 py-[1px] leading-none"
                >
                  {{ unreadMessages() }}
                </span>
              </a>
            </ng-container>

            <ng-template #userChatMobile>
              <a
                routerLink="/chat"
                title="Mensajes"
                aria-label="Mensajes"
                class="relative grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
              >
                <mat-icon class="!text-[20px]">chat_bubble</mat-icon>
                <span
                  *ngIf="unreadMessages() > 0"
                  class="absolute -top-1.5 -right-1.5 text-[9px] rounded-full bg-rose-500 text-white px-1.5 py-[1px] leading-none"
                >
                  {{ unreadMessages() }}
                </span>
              </a>
            </ng-template>
          </ng-container>

          <!-- Carro -->
          <a
            routerLink="/cart"
            title="Carro"
            aria-label="Carro"
            class="relative grid place-items-center w-8 h-8 rounded-full bg-white/10 hover:bg-white/20 transition"
          >
            <mat-icon class="!text-[20px]">shopping_cart</mat-icon>
            <span
              *ngIf="(count$ | async) as count"
              class="absolute -top-1.5 -right-1.5 text-[9px] rounded-full bg-amber-400 text-black px-1.5 py-[1px] leading-none"
            >
              {{ count }}
            </span>
          </a>
        </div>
      </div>
    </div>
  </div>
</header>
